// CSS spinner taken from https://stephanwagner.me/only-css-loading-spinner
//
// Another solution could be a SVG background-image like in Bootstrap v4.0.0-alpha.6:
// - https://v4-alpha.getbootstrap.com/components/forms/#examples
// - https://github.com/twbs/bootstrap/blob/v4.0.0-alpha.6/scss/_forms.scss
//
// Note: [Can I use a :before or :after pseudo-element on an input field?](https://stackoverflow.com/q/2587669)

$spinner-size: 20px !default;

@keyframes spinner {
  to {
    transform: rotate(360deg);
  }
}

%spinner {
  width: $spinner-size;
  height: $spinner-size;

  // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_forms.scss#L17
  border-width: $input-border-width * 2;
  border-style: solid;
  border-radius: 50%;

  animation: spinner 0.6s linear infinite;
}

// See https://github.com/postcss/autoprefixer/issues/1153
$input-height-without-calc-for-ie: str-replace($input-height, 'calc');

// For <Input>
input.is-pending {
  padding-right: calc(#{$spinner-size} - #{$input-border-width} * 2 + #{$input-padding-x});

  ~ .spinner {
    float: right;
    margin-right: calc(#{$spinner-size} + #{$input-padding-x} / 2);
    margin-top: calc((#{$input-height-without-calc-for-ie} + #{$spinner-size}) / -2);

    &::before {
      // Cannot use "content: '\a0\a0\a0\a0'" and remove spinner's width, height, "position: absolute" attributes
      // otherwise we cannot be sure the spinner is a perfect circle
      content: '';

      @extend %spinner;
      position: absolute;

      // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_forms.scss#L17
      border-color: $input-border-color;
      border-top-color: $input-color;
    }
  }
}

// For <button>
.btn-spinner {
  display: inline-flex;
  align-items: center;

  span.spinner {
    @extend %spinner;

    // FIXME Needed by IE10, IE11 is OK
    display: inline-block;

    // Space between the spinner and the button text
    margin-right: 0.5ch;
  }

  // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_buttons.scss#L62
  @each $color, $value in $theme-colors {
    &.btn-#{$color} {
      span.spinner {
        // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/mixins/_buttons.scss#L7
        border-color: color-yiq($value);
        border-top-color: $value;
      }
    }
  }
}
